<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suno AI Music Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'pulse-glow': 'pulse-glow 2s ease-in-out infinite alternate'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes pulse-glow {
            from { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
            to { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.4); }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-hover:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading-dots::after {
            content: '';
            animation: loading-dots 1.5s infinite;
        }

        @keyframes loading-dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900">
    
    <!-- Header -->
    <div class="text-center py-8">
        <h1 class="text-4xl font-bold text-white mb-2 flex items-center justify-center gap-2">
            <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
            </svg>
            Suno AI Music Generator
        </h1>
        <p class="text-blue-200">Generate music from text using Suno AI</p>
    </div>

    <div class="max-w-4xl mx-auto px-6">
        
        <!-- Generation Form -->
        <div class="glass-effect rounded-2xl p-6 mb-6">
            <form id="musicForm" class="space-y-6">
                
                <!-- API Key Input -->
                <div>
                    <label class="block text-white font-medium mb-2">Suno API Key *</label>
                    <input 
                        type="password" 
                        id="apiKey" 
                        placeholder="Enter your Suno API key"
                        class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-white/60 border border-white/30 focus:border-blue-400 focus:outline-none"
                        required
                    />
                    <p class="text-white/60 text-sm mt-1">Get your API key from <a href="https://sunoapi.org" target="_blank" class="text-blue-300 hover:text-blue-200">sunoapi.org</a></p>
                </div>

                <!-- Prompt Input -->
                <div>
                    <label class="block text-white font-medium mb-2">Music Description *</label>
                    <textarea 
                        id="prompt" 
                        placeholder="Describe the music you want... e.g., 'A chill lo-fi beat with soft piano and rain sounds'"
                        class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-white/60 border border-white/30 focus:border-blue-400 focus:outline-none resize-none"
                        rows="3"
                        required
                    ></textarea>
                </div>

                <!-- Advanced Options (Collapsible) -->
                <div>
                    <button 
                        type="button" 
                        id="toggleAdvanced"
                        class="text-white font-medium mb-3 flex items-center gap-2 hover:text-blue-300"
                    >
                        <svg id="advancedArrow" class="h-4 w-4 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                        Advanced Options
                    </button>
                    
                    <div id="advancedOptions" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-white font-medium mb-2">Lyrics (Optional)</label>
                            <textarea 
                                id="lyrics" 
                                placeholder="Enter custom lyrics (leave empty for instrumental)"
                                class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-white/60 border border-white/30 focus:border-blue-400 focus:outline-none resize-none"
                                rows="2"
                            ></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-white font-medium mb-2">Tags (Optional)</label>
                            <input 
                                type="text" 
                                id="tags"
                                placeholder="e.g., pop, upbeat, piano"
                                class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-white/60 border border-white/30 focus:border-blue-400 focus:outline-none"
                            />
                        </div>
                        
                        <div>
                            <label class="flex items-center text-white">
                                <input type="checkbox" id="instrumental" class="mr-2 rounded">
                                Make it instrumental
                            </label>
                        </div>
                        
                        <div>
                            <label class="flex items-center text-white">
                                <input type="checkbox" id="makeItWhole" class="mr-2 rounded">
                                Generate full song (longer)
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Generate Button -->
                <button 
                    type="submit" 
                    id="generateBtn"
                    class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 px-6 rounded-lg font-medium hover:from-blue-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 btn-hover transition-all duration-200 text-lg"
                >
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                    </svg>
                    Generate Music
                </button>

            </form>
        </div>

        <!-- Status Section -->
        <div id="statusSection" class="glass-effect rounded-2xl p-6 mb-6 hidden">
            <div class="flex items-center gap-3 mb-4">
                <svg class="h-5 w-5 text-blue-400 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                <span class="text-white font-medium">Generating your music<span class="loading-dots"></span></span>
            </div>
            <p id="statusText" class="text-white/70 text-sm mb-3">This may take 1-2 minutes...</p>
            <div class="w-full bg-white/20 rounded-full h-2">
                <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>

        <!-- Generated Music Section -->
        <div id="musicSection" class="glass-effect rounded-2xl p-6 mb-6 hidden">
            <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3l14 9-14 9V3z"/>
                </svg>
                Your Generated Music
            </h2>
            <div id="musicResults" class="space-y-4">
                <!-- Generated music will appear here -->
            </div>
        </div>

        <!-- Error Section -->
        <div id="errorSection" class="glass-effect rounded-2xl p-6 mb-6 border-red-500/30 bg-red-500/10 hidden">
            <div class="flex items-center gap-3 mb-2">
                <svg class="h-5 w-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span class="text-red-400 font-medium">Error</span>
            </div>
            <p id="errorText" class="text-red-300"></p>
        </div>

    </div>

    <script>
        // Configuration - Update these URLs based on the actual Suno API provider you're using
        const API_BASE_URL = 'https://api.sunoapi.org'; // or your preferred Suno API provider
        
        // Global state
        let generatedTracks = JSON.parse(localStorage.getItem('generatedTracks') || '[]');
        let isGenerating = false;

        // DOM elements
        const elements = {
            form: document.getElementById('musicForm'),
            apiKey: document.getElementById('apiKey'),
            prompt: document.getElementById('prompt'),
            lyrics: document.getElementById('lyrics'),
            tags: document.getElementById('tags'),
            instrumental: document.getElementById('instrumental'),
            makeItWhole: document.getElementById('makeItWhole'),
            generateBtn: document.getElementById('generateBtn'),
            toggleAdvanced: document.getElementById('toggleAdvanced'),
            advancedOptions: document.getElementById('advancedOptions'),
            advancedArrow: document.getElementById('advancedArrow'),
            statusSection: document.getElementById('statusSection'),
            statusText: document.getElementById('statusText'),
            progressBar: document.getElementById('progressBar'),
            musicSection: document.getElementById('musicSection'),
            musicResults: document.getElementById('musicResults'),
            errorSection: document.getElementById('errorSection'),
            errorText: document.getElementById('errorText')
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadSavedData();
            loadPreviousTracks();
        });

        function setupEventListeners() {
            elements.form.addEventListener('submit', handleGenerate);
            elements.toggleAdvanced.addEventListener('click', toggleAdvancedOptions);
        }

        function toggleAdvancedOptions() {
            const isHidden = elements.advancedOptions.classList.contains('hidden');
            if (isHidden) {
                elements.advancedOptions.classList.remove('hidden');
                elements.advancedArrow.style.transform = 'rotate(90deg)';
            } else {
                elements.advancedOptions.classList.add('hidden');
                elements.advancedArrow.style.transform = 'rotate(0deg)';
            }
        }

        function loadSavedData() {
            const savedApiKey = localStorage.getItem('sunoApiKey');
            if (savedApiKey) {
                elements.apiKey.value = savedApiKey;
            }
        }

        function saveApiKey(apiKey) {
            localStorage.setItem('sunoApiKey', apiKey);
        }

        function loadPreviousTracks() {
            if (generatedTracks.length > 0) {
                showMusicSection();
                generatedTracks.forEach(track => addTrackToUI(track));
            }
        }

        function showError(message) {
            elements.errorText.textContent = message;
            elements.errorSection.classList.remove('hidden');
            elements.errorSection.classList.add('fade-in');
            setTimeout(() => {
                elements.errorSection.classList.add('hidden');
            }, 10000);
        }

        function hideError() {
            elements.errorSection.classList.add('hidden');
        }

        function showStatusSection() {
            elements.statusSection.classList.remove('hidden');
            elements.statusSection.classList.add('fade-in');
        }

        function hideStatusSection() {
            elements.statusSection.classList.add('hidden');
        }

        function showMusicSection() {
            elements.musicSection.classList.remove('hidden');
            elements.musicSection.classList.add('fade-in');
        }

        function updateProgress(percent, statusMessage = '') {
            elements.progressBar.style.width = `${percent}%`;
            if (statusMessage) {
                elements.statusText.textContent = statusMessage;
            }
        }

        async function handleGenerate(e) {
            e.preventDefault();
            hideError();

            const apiKey = elements.apiKey.value.trim();
            const prompt = elements.prompt.value.trim();

            if (!apiKey) {
                showError('Please enter your Suno API key');
                return;
            }

            if (!prompt) {
                showError('Please enter a music description');
                return;
            }

            saveApiKey(apiKey);
            await generateMusic(apiKey, prompt);
        }

        async function generateMusic(apiKey, prompt) {
            if (isGenerating) return;
            
            isGenerating = true;
            elements.generateBtn.disabled = true;
            elements.generateBtn.innerHTML = `
                <svg class="h-5 w-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                Generating...
            `;

            showStatusSection();
            updateProgress(10, 'Starting generation...');

            try {
                // Prepare request data
                const requestData = {
                    prompt: prompt,
                    make_instrumental: elements.instrumental.checked,
                    wait_audio: false // For async generation
                };

                // Add optional parameters
                if (elements.lyrics.value.trim()) {
                    requestData.lyrics = elements.lyrics.value.trim();
                }
                
                if (elements.tags.value.trim()) {
                    requestData.tags = elements.tags.value.trim();
                }

                if (elements.makeItWhole.checked) {
                    requestData.make_it_whole_song = true;
                }

                updateProgress(25, 'Sending request to Suno AI...');

                // Call the Suno API
                const response = await fetch(`${API_BASE_URL}/api/generate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }

                updateProgress(50, 'Generation started, waiting for completion...');

                // Start polling for completion
                await pollForCompletion(apiKey, result.id || result.ids, prompt);

            } catch (error) {
                console.error('Generation failed:', error);
                showError(`Failed to generate music: ${error.message}`);
                hideStatusSection();
            } finally {
                resetGenerateButton();
                isGenerating = false;
            }
        }

        async function pollForCompletion(apiKey, ids, prompt) {
            const maxAttempts = 60; // 5 minutes max
            let attempts = 0;
            
            const pollInterval = setInterval(async () => {
                attempts++;
                
                try {
                    updateProgress(50 + (attempts * 0.8), `Generating music... (${attempts * 5}s)`);
                    
                    const response = await fetch(`${API_BASE_URL}/api/get?ids=${Array.isArray(ids) ? ids.join(',') : ids}`, {
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`Status check failed: ${response.status}`);
                    }

                    const results = await response.json();
                    const tracks = Array.isArray(results) ? results : [results];
                    
                    // Check if any tracks are completed
                    const completedTracks = tracks.filter(track => 
                        track.status === 'complete' && track.audio_url
                    );

                    if (completedTracks.length > 0) {
                        clearInterval(pollInterval);
                        updateProgress(100, 'Music generated successfully!');
                        
                        // Add completed tracks to UI
                        completedTracks.forEach(track => {
                            const trackData = {
                                id: track.id,
                                prompt: prompt,
                                title: track.title || 'Generated Music',
                                audioUrl: track.audio_url,
                                imageUrl: track.image_url,
                                createdAt: new Date().toISOString(),
                                duration: track.duration || 'Unknown'
                            };
                            
                            generatedTracks.unshift(trackData);
                            addTrackToUI(trackData);
                        });

                        saveTracksToStorage();
                        showMusicSection();
                        hideStatusSection();
                        return;
                    }

                    // Check if generation failed
                    const failedTracks = tracks.filter(track => 
                        track.status === 'error' || track.status === 'failed'
                    );

                    if (failedTracks.length > 0) {
                        clearInterval(pollInterval);
                        throw new Error('Music generation failed');
                    }

                    if (attempts >= maxAttempts) {
                        clearInterval(pollInterval);
                        throw new Error('Generation timeout - please try again');
                    }

                } catch (error) {
                    clearInterval(pollInterval);
                    console.error('Polling error:', error);
                    showError(`Error checking generation status: ${error.message}`);
                    hideStatusSection();
                }
            }, 5000); // Check every 5 seconds
        }

        function resetGenerateButton() {
            elements.generateBtn.disabled = false;
            elements.generateBtn.innerHTML = `
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                </svg>
                Generate Music
            `;
        }

        function addTrackToUI(track) {
            const trackElement = document.createElement('div');
            trackElement.className = 'bg-white/10 rounded-lg p-4 fade-in';
            trackElement.innerHTML = `
                <div class="flex items-start gap-4">
                    ${track.imageUrl ? `
                        <img src="${track.imageUrl}" alt="Album Art" class="w-16 h-16 rounded-lg object-cover">
                    ` : `
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-blue-500 rounded-lg flex items-center justify-center">
                            <svg class="h-8 w-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                            </svg>
                        </div>
                    `}
                    <div class="flex-1">
                        <h3 class="text-white font-medium text-lg mb-1">${track.title}</h3>
                        <p class="text-white/70 text-sm mb-2">${track.prompt}</p>
                        <p class="text-white/50 text-xs">Generated ${new Date(track.createdAt).toLocaleDateString()}</p>
                    </div>
                    <div class="flex flex-col gap-2">
                        <button onclick="downloadTrack('${track.audioUrl}', '${track.title}')" class="p-2 bg-green-500 hover:bg-green-600 text-white rounded-lg btn-hover transition-all duration-200 flex items-center gap-1">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Download
                        </button>
                    </div>
                </div>
                <div class="mt-4">
                    <audio controls class="w-full">
                        <source src="${track.audioUrl}" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                </div>
            `;

            elements.musicResults.insertBefore(trackElement, elements.musicResults.firstChild);
        }

        function saveTracksToStorage() {
            // Limit to last 20 tracks to prevent excessive storage
            if (generatedTracks.length > 20) {
                generatedTracks = generatedTracks.slice(0, 20);
            }
            localStorage.setItem('generatedTracks', JSON.stringify(generatedTracks));
        }

        async function downloadTrack(audioUrl, title) {
            try {
                const response = await fetch(audioUrl);
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${title.replace(/[^a-z0-9]/gi, '_')}.mp3`;
                document.body.appendChild(a);
                a.click();
                
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } catch (error) {
                console.error('Download failed:', error);
                showError('Download failed. Please try right-clicking the audio player and selecting "Save audio as..."');
            }
        }
    </script>

</body>
</html>